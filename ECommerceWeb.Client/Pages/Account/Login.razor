@page "/Account/Login"
@inject IUserProxy userProxy
@inject NavigationManager navigationManager
@inject AuthenticationStateProvider authenticationStateProvider
@inject IToastService toastService

<PageTitle>Login</PageTitle>

<section class="login-tabs padding-large">
    <div class="container my-5 py-5">
        <div class="row">
            <div class="tabs-listing">
                <nav>
                    <div class="nav nav-tabs d-flex justify-content-center border-dark-subtle mb-3" id="nav-tab"
                         role="tablist">
                        <button class="nav-link mx-3 fs-3 border-bottom border-dark-subtle border-0 text-uppercase active"
                                id="nav-sign-in-tab" data-bs-toggle="tab" data-bs-target="#nav-sign-in" type="button"
                                role="tab" aria-controls="nav-sign-in" aria-selected="true">
                            Log In
                        </button>
                        <button class="nav-link mx-3 fs-3 border-bottom border-dark-subtle border-0 text-uppercase"
                                id="nav-register-tab" data-bs-toggle="tab" data-bs-target="#nav-register" type="button"
                                role="tab" aria-controls="nav-register" aria-selected="false">
                            Sign Up
                        </button>
                    </div>
                </nav>

                <div class="tab-content" id="nav-tabContent">

                    @* form login *@
                    <div class="tab-pane fade active show" id="nav-sign-in" role="tabpanel"
                         aria-labelledby="nav-sign-in-tab">
                        <div class="col-lg-8 offset-lg-2 mt-5">

                            <p class="mb-0">Log-In With Social</p>
                            <hr class="my-1">
                            <div class="row mt-4 mb-5">
                                <div class="d-grid col-md-6 my-2">
                                    <a href="#" class="btn btn-outline-dark btn-lg text-uppercase fs-6 rounded-1 ">
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <iconify-icon icon="ion:logo-google"
                                                          class="signup-social-icon me-2"></iconify-icon>
                                            <p class="mb-0">Google</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="d-grid col-md-6 my-2">
                                    <a href="#" class="btn btn-outline-dark btn-lg text-uppercase fs-6 rounded-1 ">
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <iconify-icon icon="ion:logo-facebook"
                                                          class="signup-social-icon me-2"></iconify-icon>
                                            <p class="mb-0">Facebook</p>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <p class="mb-0">Or Log-In With Email</p>
                            <hr class="my-1">

                            <EditForm Model="loginDtoRequest" OnValidSubmit="ValidLogin" class="form-group flex-wrap ">
                                <div class="form-input col-lg-12 my-4">
                                    <DataAnnotationsValidator />

                                    <input class="form-control mb-3 p-4" type="text" id="username"
                                           @bind-value="loginDtoRequest.UserName" placeholder="Username" />
                                    
                                    <ValidationMessage For="@(() => loginDtoRequest.UserName)" />


                                    <input placeholder="Enter password"
                                           class="form-control mb-3 p-4" aria-describedby="passwordHelpBlock" type="password" id="password"
                                           @bind-value="loginDtoRequest.Password" />
                                    
                                    <ValidationMessage For="@(() => loginDtoRequest.Password)" />

                                    <label class="py-3 d-flex flex-wrap justify-content-between">
                                        <div>
                                            <input type="checkbox" class="d-inline">
                                            <span class="label-body ">Remember Me</span>
                                        </div>

                                        <div id="passwordHelpBlock" class="form-text ">
                                            <a href="#" class="text-primary  fw-bold"> Forgot Password?</a>
                                        </div>
                                    </label>

                                    <div class="d-grid my-3">
                                        <button class="btn btn-dark btn-lg rounded-1" type="submit">Log in</button>
                                    </div>

                                </div>

                            </EditForm>
                         
                        </div>

                    </div>

                    @* Form register *@
                    <div class="tab-pane fade" id="nav-register" role="tabpanel" aria-labelledby="nav-register-tab">
                        <div class="col-lg-8 offset-lg-2 mt-5">

                            <p class="mb-0">Sign-up With Social</p>
                            <hr class="my-1">
                            <div class="row mt-4 mb-5">
                                <div class="d-grid col-md-6 my-2">
                                    <a href="#" class="btn btn-outline-dark btn-lg text-uppercase fs-6 rounded-1 ">
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <iconify-icon icon="ion:logo-google"
                                                          class="signup-social-icon me-2"></iconify-icon>
                                            <p class="mb-0">Google</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="d-grid col-md-6 my-2">
                                    <a href="#" class="btn btn-outline-dark btn-lg text-uppercase fs-6 rounded-1 ">
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <iconify-icon icon="ion:logo-facebook"
                                                          class="signup-social-icon me-2"></iconify-icon>
                                            <p class="mb-0">Facebook</p>
                                        </div>
                                    </a>
                                </div>
                            </div>


                            <p class="mb-0">Or Sign-Up With Email</p>
                            <hr class="my-1">

                            <form id="formSign-Up" class="form-group flex-wrap ">
                                <div class="form-input col-lg-12 my-4">

                                    <input type="text" id="exampleInputName" name="email"
                                           placeholder="Your full name" class="form-control mb-3 p-4">
                                    <input type="text" id="Sign-UpexampleInputEmail1" name="email"
                                           placeholder="Your email address" class="form-control mb-3 p-4">
                                    <input type="password" id="signupinputPassword1" placeholder="Set your password"
                                           class="form-control mb-3 p-4" aria-describedby="passwordHelpBlock">
                                    <input type="password" id="inputPassword2" placeholder="Retype your password"
                                           class="form-control mb-3 p-4" aria-describedby="passwordHelpBlock">

                                    <label class="py-3 d-flex flex-wrap justify-content-between">
                                        <div>
                                            <input type="checkbox" required="" class="d-inline">
                                            <span class="label-body ">Remember Me</span>
                                        </div>

                                        <div id="passwordHelpBlock" class="form-text ">
                                            <a href="#" class="text-primary  fw-bold"> Forgot Password?</a>
                                        </div>
                                    </label>
                                    <div class="d-grid my-3">
                                        <a href="#" class="btn btn-dark btn-lg rounded-1">Sign Up</a>
                                    </div>

                                </div>
                            </form>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

<section id="insta" class="my-5">
    <div class="row g-0 py-5">
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta1.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta2.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta3.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta4.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta5.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
        <div class="col instagram-item  text-center position-relative">
            <div class="icon-overlay d-flex justify-content-center position-absolute">
                <iconify-icon class="text-white" icon="la:instagram"></iconify-icon>
            </div>
            <a href="#">
                <img src="css/Theme/images/insta6.jpg" alt="insta-img" class="img-fluid rounded-3">
            </a>
        </div>
    </div>
</section>

@code {
    private LoginDtoRequest loginDtoRequest { get; set; } = new LoginDtoRequest();

    private async Task ValidLogin()
    {
        try
        {
            var response = await userProxy.Login(loginDtoRequest);
            if (response.success)
            {
                var auth = (AuthenticationService)authenticationStateProvider;
                await auth.Authenticate(response);
                navigationManager.NavigateTo("/");

            }
            else
            {
                toastService.ShowError(response.msnError!);
                //Console.WriteLine(response.msnError);

            }
        }
        catch (Exception ex)
        {
            toastService.ShowError(ex.Message);
            //Console.WriteLine(ex.Message);

        }

    }

}
